var Table = require('../../lib/views/Table');
var _ = require('lodash');
var moduleData = {
  moduleConfig: {
    'title': 'test',
    'format': {
      'type': 'number'
    },
    'module-type': 'kpi',
    'value-attribute': 'specific_data',
    'data-source': {
      'data-group': 'transactional-services',
      'data-type': 'summaries',
      'query-params': {
        'sort_by': '_timestamp:descending',
        'filter_by': [
          'service_id:bis-accounts-filing',
          'type:seasonally-adjusted'
        ]
      }
    }
  },
  dataSource: {
    data: [
      {
        '_quarter_start_at': '2013-07-01T00:00:00+00:00',
        '_timestamp': '2013-07-01T00:00:00+00:00',
        'end_at': '2014-07-01T00:00:00+00:00',
        'specific_data': 1
      },
      {
        '_quarter_start_at': '2013-04-01T00:00:00+00:00',
        '_timestamp': '2013-07-01T00:00:00+00:00',
        'end_at': '2014-07-01T00:00:00+00:00',
        'specific_data': 15
      },
      {
        '_quarter_start_at': '2013-01-01T00:00:00+00:00',
        '_timestamp': '2013-07-01T00:00:00+00:00',
        'end_at': '2014-07-01T00:00:00+00:00',
        'specific_data': 2
      }
    ]
  },
  axes: {
    'x': {
      'label': 'Quarter',
      'key': ['_quarter_start_at', 'end_at'],
      'format': 'date'
    },
    'y': [{
      'label': 'test',
      'key': 'specific_data',
      'format': {
        'type': 'number'
      }
    }]
  }
};

describe('Table View', function () {
  var table;

  describe('init', function () {

    beforeEach(function () {
      sinon.stub(Table.prototype, 'tabularise');
      table = new Table(_.cloneDeep(moduleData));
    });

    afterEach(function () {
      Table.prototype.tabularise.restore();
    });

    it('should call tabularise()', function () {
      Table.prototype.tabularise.should.have.been.called;
    });

  });

  describe('tabularise()', function () {

    beforeEach(function () {
      table = new Table(_.cloneDeep(moduleData));
    });

    it('creates a tabular view of the data', function () {
      table.data.should.eql([
        [
          'Quarter',
          '1 July 2013 to 30 June 2014',
          '1 April 2013 to 30 June 2014',
          '1 January 2013 to 30 June 2014'
        ],
        [
          'test',
          1,
          15,
          2
        ]
      ]);
    });

    describe('sorting data in tables', function () {
      var sortedTable;
      var sortedModuleData = _.cloneDeep(moduleData);

      beforeEach(function () {

        sortedModuleData.moduleConfig['sort-by'] = 'specific_data';
        sortedTable = new Table(sortedModuleData);
      });

      it('sorts the data with the sort-by key and the sort-order key (defaults to descending)',
        function () {
          sortedTable.data.should.eql([
            [
              'Quarter',
              '1 April 2013 to 30 June 2014',
              '1 January 2013 to 30 June 2014',
              '1 July 2013 to 30 June 2014'
            ],
            [
              'test',
              15,
              2,
              1
            ]
          ]);
        });

      it('sorts the data with the sort-by key and the sort-order key', function () {
        sortedModuleData.moduleConfig['sort-order'] = 'ascending';
        sortedTable = new Table(sortedModuleData);

        sortedTable.data.should.eql([
          [
            'Quarter',
            '1 July 2013 to 30 June 2014',
            '1 January 2013 to 30 June 2014',
            '1 April 2013 to 30 June 2014'
          ],
          [
            'test',
            1,
            2,
            15
          ]
        ]);
      });
    });
  });

  describe('render()', function () {

    beforeEach(function () {
      table = new Table(_.cloneDeep(moduleData));
    });

    it('formats the values', function () {
      table.render().should.eql([
        [
          'Quarter',
          '1 July 2013 to 30 June 2014',
          '1 April 2013 to 30 June 2014',
          '1 January 2013 to 30 June 2014'
        ],
        [
          'test',
          '1',
          '15',
          '2'
        ]
      ]);
    });

  });

  describe('grouped-timeseries', function () {

    beforeEach(function () {
      moduleData.moduleConfig = {
        'value-attribute': 'volume:sum',
        'module-type': 'grouped_timeseries',
        'data-source': {
          'data-group': 'vehicle-licensing',
          'data-type': 'volumetrics',
          'query-params': {
            collect: [ 'volume:sum' ],
            group_by: [ 'channel' ],
            period: 'month',
            filter_by: [ 'service:tax-disc' ],
            flatten: true,
            duration: 12
          }
        }
      };

      moduleData.dataSource.data = [
        {
          _count: 4,
          _end_at: '2014-02-01T00:00:00+00:00',
          _start_at: '2014-01-01T00:00:00+00:00',
          channel: 'manual',
          'volume:sum': 13603
        },
        {
          _count: 2,
          _end_at: '2014-02-01T00:00:00+00:00',
          _start_at: '2014-01-01T00:00:00+00:00',
          channel: 'assisted-digital',
          'volume:sum': 1306292
        },
        {
          _count: 4,
          _end_at: '2014-02-01T00:00:00+00:00',
          _start_at: '2014-01-01T00:00:00+00:00',
          channel: 'fully-digital',
          'volume:sum': 1863942
        },
        {
          _count: 4,
          _end_at: '2014-03-01T00:00:00+00:00',
          _start_at: '2014-02-01T00:00:00+00:00',
          channel: 'manual',
          'volume:sum': 12219
        },
        {
          _count: 2,
          _end_at: '2014-03-01T00:00:00+00:00',
          _start_at: '2014-02-01T00:00:00+00:00',
          channel: 'assisted-digital',
          'volume:sum': 1637752
        },
        {
          _count: 4,
          _end_at: '2014-03-01T00:00:00+00:00',
          _start_at: '2014-02-01T00:00:00+00:00',
          channel: 'fully-digital',
          'volume:sum': 2514166
        }
      ];

      moduleData.axes = {
        x: {
          label: 'Date',
          key: '_start_at',
          format: {
            type: 'date',
            format: 'MMMM YYYY'
          }
        },
        y: [
          {
            format: 'integer',
            groupId: 'fully-digital',
            label: 'Digital and automated phone'
          },
          {
            format: 'integer',
            groupId: 'assisted-digital',
            label: 'Post Office'
          },
          {
            format: 'integer',
            groupId: 'manual',
            label: 'DVLA centre'
          }
        ]
      };

      table = new Table(_.cloneDeep(moduleData));
    });

    describe('tabularise()', function () {
      it('creates a tabular view of the data', function () {

        table.data.should.eql([
          [ 'Date', 'January 2014', 'February 2014' ],
          [ 'Digital and automated phone', 1863942, 2514166 ],
          [ 'Post Office', 1306292, 1637752 ],
          [ 'DVLA centre', 13603, 12219 ],
          [ 'Totals', 3183837, 4164137 ]
        ]);

      });
    });

    describe('render()', function () {
      it('formats the values', function () {
        table.render().should.eql([
          [ 'Date', 'January 2014', 'February 2014' ],
          [ 'Digital and automated phone', '1,863,942', '2,514,166' ],
          [ 'Post Office', '1,306,292', '1,637,752' ],
          [ 'DVLA centre', '13,603', '12,219' ],
          [ 'Totals', '3,183,837', '4,164,137' ]
        ]);
      });
    });

  });

  describe('grouped_timeseries with multiple group by', function () {
    var multGroup = require('../fixtures/module-config-grouped-time-series-multiple-group-by.json');

    beforeEach(function () {
      table = new Table(_.cloneDeep(multGroup));
    });

    describe('tabularise()', function () {
      it('creates a tabular view of the data', function () {
        table.data.should.eql([
          [ 'Date',
            '9 to 15 December 2013',
            '16 to 22 December 2013',
            '23 to 29 December 2013',
            '30 December 2013 to 5 January 2014',
            '6 to 12 January 2014',
            '13 to 19 January 2014',
            '20 to 26 January 2014',
            '27 January to 2 February 2014',
            '3 to 9 February 2014',
            '10 to 16 February 2014',
            '17 to 23 February 2014',
            '24 February to 2 March 2014',
            '3 to 9 March 2014',
            '10 to 16 March 2014',
            '17 to 23 March 2014',
            '24 to 30 March 2014',
            '31 March to 6 April 2014',
            '7 to 13 April 2014',
            '14 to 20 April 2014',
            '21 to 27 April 2014',
            '28 April to 4 May 2014',
            '5 to 11 May 2014',
            '12 to 18 May 2014',
            '19 to 25 May 2014',
            '26 May to 1 June 2014',
            '2 to 8 June 2014',
            '9 to 15 June 2014',
            '16 to 22 June 2014',
            '23 to 29 June 2014',
            '30 June to 6 July 2014',
            '7 to 13 July 2014',
            '14 to 20 July 2014',
            '21 to 27 July 2014',
            '28 July to 3 August 2014',
            '4 to 10 August 2014',
            '11 to 17 August 2014',
            '18 to 24 August 2014',
            '25 August to 31 August 2014',
            '1 to 7 September 2014',
            '8 to 14 September 2014',
            '15 to 21 September 2014',
            '22 to 28 September 2014',
            '29 September to 5 October 2014',
            '6 to 12 October 2014',
            '13 to 19 October 2014',
            '20 to 26 October 2014',
            '27 October to 2 November 2014',
            '3 to 9 November 2014',
            '10 to 16 November 2014',
            '17 to 23 November 2014',
            '24 November to 30 November 2014',
            '1 to 7 December 2014',
            '8 to 14 December 2014',
            '15 to 21 December 2014',
            '22 to 28 December 2014',
            '29 December 2014 to 4 January 2015',
            '5 to 11 January 2015',
            '12 to 18 January 2015',
            '19 to 25 January 2015',
            '26 January to 1 February 2015',
            '2 to 8 February 2015',
            '9 to 15 February 2015',
            '16 to 22 February 2015',
            '23 February to 1 March 2015',
            '2 to 8 March 2015'
          ],
          [ '15/16 - Started',
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            19,
            15265,
            20956,
            92352,
            43330,
            20132,
            38693
          ],
          [ '15/16 - Submitted',
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000,
            11,
            13666,
            16919,
            72377,
            36916,
            18240,
            34132
          ],
          [ '14/15 - Started',
            1000,
            1000,
            1000,
            1000,
            1000,
            572,
            16618,
            26752,
            19435,
            15905,
            17960,
            121708,
            43067,
            24143,
            37824,
            51760,
            56195,
            41493,
            34988,
            56820,
            41553,
            40972,
            36177,
            41838,
            54291,
            27792,
            26152,
            29305,
            36943,
            23330,
            21198,
            19432,
            18869,
            17727,
            18891,
            20149,
            23160,
            18791,
            18904,
            15169,
            12778,
            10409,
            6890,
            5329,
            3641,
            2820,
            2216,
            2264,
            2027,
            2229,
            1776,
            1859,
            1750,
            1596,
            718,
            1260,
            2542,
            2487,
            2175,
            1322,
            1127,
            1039,
            920,
            891,
            874
          ],
          [ '14/15 - Submitted',
            1000,
            1000,
            1000,
            1000,
            1000,
            251,
            7846,
            13107,
            11154,
            10105,
            12776,
            114766,
            37053,
            18247,
            27995,
            41055,
            46647,
            36108,
            31452,
            51577,
            38295,
            38649,
            34333,
            42451,
            58257,
            26938,
            25370,
            28709,
            39101,
            23292,
            20969,
            19325,
            18843,
            18292,
            21254,
            32903,
            41127,
            24096,
            20122,
            16590,
            13416,
            9385,
            6322,
            4622,
            3386,
            2603,
            1976,
            1959,
            1789,
            1860,
            1504,
            1627,
            1516,
            1369,
            661,
            1167,
            2100,
            2086,
            1777,
            1413,
            1008,
            971,
            855,
            828,
            774
          ],
          [ '13/14 - Started',
            2342,
            1716,
            719,
            1337,
            2563,
            2320,
            1363,
            1531,
            1361,
            1242,
            1174,
            1217,
            957,
            928,
            955,
            1013,
            850,
            888,
            536,
            654,
            659,
            681,
            687,
            640,
            555,
            441,
            359,
            331,
            303,
            262,
            206,
            247,
            205,
            206,
            246,
            115,
            65,
            31,
            62,
            31,
            48,
            40,
            46,
            45,
            35,
            38,
            31,
            34,
            42,
            26,
            27,
            18,
            31,
            21,
            4,
            10,
            18,
            21,
            10,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000
          ],
          [ '13/14 - Submitted',
            1789,
            1323,
            531,
            1036,
            1754,
            1530,
            1238,
            1631,
            1442,
            1242,
            1180,
            1211,
            903,
            868,
            913,
            920,
            798,
            865,
            542,
            582,
            613,
            640,
            646,
            633,
            549,
            376,
            303,
            284,
            240,
            210,
            156,
            201,
            175,
            155,
            226,
            103,
            63,
            31,
            64,
            31,
            40,
            33,
            32,
            35,
            29,
            39,
            25,
            27,
            33,
            23,
            24,
            12,
            23,
            25,
            4,
            10,
            18,
            19,
            9,
            1000,
            1000,
            1000,
            1000,
            1000,
            1000
          ],
          [ 'Totals',
            8131,
            7039,
            5250,
            6373,
            8317,
            6673,
            29065,
            45021,
            35392,
            30494,
            35090,
            240902,
            83980,
            46186,
            69687,
            96748,
            106490,
            81354,
            69518,
            111633,
            83120,
            82942,
            73843,
            87562,
            115652,
            57547,
            54184,
            60629,
            78587,
            49094,
            44529,
            41205,
            40092,
            38380,
            42617,
            55270,
            66415,
            44949,
            41152,
            33821,
            28282,
            21867,
            15290,
            12031,
            9091,
            7500,
            6248,
            6284,
            5891,
            6138,
            5331,
            5516,
            5320,
            5011,
            3387,
            4447,
            6678,
            6613,
            4001,
            33666,
            42010,
            168739,
            84021,
            42091,
            76473
          ]
        ]);

      });
    });

    describe('render()', function () {
      it('formats the values', function () {
        table.render().should.eql([
          [ 'Date',
            '9 to 15 December 2013',
            '16 to 22 December 2013',
            '23 to 29 December 2013',
            '30 December 2013 to 5 January 2014',
            '6 to 12 January 2014',
            '13 to 19 January 2014',
            '20 to 26 January 2014',
            '27 January to 2 February 2014',
            '3 to 9 February 2014',
            '10 to 16 February 2014',
            '17 to 23 February 2014',
            '24 February to 2 March 2014',
            '3 to 9 March 2014',
            '10 to 16 March 2014',
            '17 to 23 March 2014',
            '24 to 30 March 2014',
            '31 March to 6 April 2014',
            '7 to 13 April 2014',
            '14 to 20 April 2014',
            '21 to 27 April 2014',
            '28 April to 4 May 2014',
            '5 to 11 May 2014',
            '12 to 18 May 2014',
            '19 to 25 May 2014',
            '26 May to 1 June 2014',
            '2 to 8 June 2014',
            '9 to 15 June 2014',
            '16 to 22 June 2014',
            '23 to 29 June 2014',
            '30 June to 6 July 2014',
            '7 to 13 July 2014',
            '14 to 20 July 2014',
            '21 to 27 July 2014',
            '28 July to 3 August 2014',
            '4 to 10 August 2014',
            '11 to 17 August 2014',
            '18 to 24 August 2014',
            '25 August to 31 August 2014',
            '1 to 7 September 2014',
            '8 to 14 September 2014',
            '15 to 21 September 2014',
            '22 to 28 September 2014',
            '29 September to 5 October 2014',
            '6 to 12 October 2014',
            '13 to 19 October 2014',
            '20 to 26 October 2014',
            '27 October to 2 November 2014',
            '3 to 9 November 2014',
            '10 to 16 November 2014',
            '17 to 23 November 2014',
            '24 November to 30 November 2014',
            '1 to 7 December 2014',
            '8 to 14 December 2014',
            '15 to 21 December 2014',
            '22 to 28 December 2014',
            '29 December 2014 to 4 January 2015',
            '5 to 11 January 2015',
            '12 to 18 January 2015',
            '19 to 25 January 2015',
            '26 January to 1 February 2015',
            '2 to 8 February 2015',
            '9 to 15 February 2015',
            '16 to 22 February 2015',
            '23 February to 1 March 2015',
            '2 to 8 March 2015'
          ],
          [ '15/16 - Started',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '19',
            '15,265',
            '20,956',
            '92,352',
            '43,330',
            '20,132',
            '38,693'
          ],
          [ '15/16 - Submitted',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '11',
            '13,666',
            '16,919',
            '72,377',
            '36,916',
            '18,240',
            '34,132'
          ],
          [ '14/15 - Started',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '572',
            '16,618',
            '26,752',
            '19,435',
            '15,905',
            '17,960',
            '121,708',
            '43,067',
            '24,143',
            '37,824',
            '51,760',
            '56,195',
            '41,493',
            '34,988',
            '56,820',
            '41,553',
            '40,972',
            '36,177',
            '41,838',
            '54,291',
            '27,792',
            '26,152',
            '29,305',
            '36,943',
            '23,330',
            '21,198',
            '19,432',
            '18,869',
            '17,727',
            '18,891',
            '20,149',
            '23,160',
            '18,791',
            '18,904',
            '15,169',
            '12,778',
            '10,409',
            '6,890',
            '5,329',
            '3,641',
            '2,820',
            '2,216',
            '2,264',
            '2,027',
            '2,229',
            '1,776',
            '1,859',
            '1,750',
            '1,596',
            '718',
            '1,260',
            '2,542',
            '2,487',
            '2,175',
            '1,322',
            '1,127',
            '1,039',
            '920',
            '891',
            '874'
          ],
          [ '14/15 - Submitted',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '251',
            '7,846',
            '13,107',
            '11,154',
            '10,105',
            '12,776',
            '114,766',
            '37,053',
            '18,247',
            '27,995',
            '41,055',
            '46,647',
            '36,108',
            '31,452',
            '51,577',
            '38,295',
            '38,649',
            '34,333',
            '42,451',
            '58,257',
            '26,938',
            '25,370',
            '28,709',
            '39,101',
            '23,292',
            '20,969',
            '19,325',
            '18,843',
            '18,292',
            '21,254',
            '32,903',
            '41,127',
            '24,096',
            '20,122',
            '16,590',
            '13,416',
            '9,385',
            '6,322',
            '4,622',
            '3,386',
            '2,603',
            '1,976',
            '1,959',
            '1,789',
            '1,860',
            '1,504',
            '1,627',
            '1,516',
            '1,369',
            '661',
            '1,167',
            '2,100',
            '2,086',
            '1,777',
            '1,413',
            '1,008',
            '971',
            '855',
            '828',
            '774'
          ],
          [ '13/14 - Started',
            '2,342',
            '1,716',
            '719',
            '1,337',
            '2,563',
            '2,320',
            '1,363',
            '1,531',
            '1,361',
            '1,242',
            '1,174',
            '1,217',
            '957',
            '928',
            '955',
            '1,013',
            '850',
            '888',
            '536',
            '654',
            '659',
            '681',
            '687',
            '640',
            '555',
            '441',
            '359',
            '331',
            '303',
            '262',
            '206',
            '247',
            '205',
            '206',
            '246',
            '115',
            '65',
            '31',
            '62',
            '31',
            '48',
            '40',
            '46',
            '45',
            '35',
            '38',
            '31',
            '34',
            '42',
            '26',
            '27',
            '18',
            '31',
            '21',
            '4',
            '10',
            '18',
            '21',
            '10',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000'
          ],
          [ '13/14 - Submitted',
            '1,789',
            '1,323',
            '531',
            '1,036',
            '1,754',
            '1,530',
            '1,238',
            '1,631',
            '1,442',
            '1,242',
            '1,180',
            '1,211',
            '903',
            '868',
            '913',
            '920',
            '798',
            '865',
            '542',
            '582',
            '613',
            '640',
            '646',
            '633',
            '549',
            '376',
            '303',
            '284',
            '240',
            '210',
            '156',
            '201',
            '175',
            '155',
            '226',
            '103',
            '63',
            '31',
            '64',
            '31',
            '40',
            '33',
            '32',
            '35',
            '29',
            '39',
            '25',
            '27',
            '33',
            '23',
            '24',
            '12',
            '23',
            '25',
            '4',
            '10',
            '18',
            '19',
            '9',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000',
            '1,000'
          ],
          [ 'Totals',
            '8,131',
            '7,039',
            '5,250',
            '6,373',
            '8,317',
            '6,673',
            '29,065',
            '45,021',
            '35,392',
            '30,494',
            '35,090',
            '240,902',
            '83,980',
            '46,186',
            '69,687',
            '96,748',
            '106,490',
            '81,354',
            '69,518',
            '111,633',
            '83,120',
            '82,942',
            '73,843',
            '87,562',
            '115,652',
            '57,547',
            '54,184',
            '60,629',
            '78,587',
            '49,094',
            '44,529',
            '41,205',
            '40,092',
            '38,380',
            '42,617',
            '55,270',
            '66,415',
            '44,949',
            '41,152',
            '33,821',
            '28,282',
            '21,867',
            '15,290',
            '12,031',
            '9,091',
            '7,500',
            '6,248',
            '6,284',
            '5,891',
            '6,138',
            '5,331',
            '5,516',
            '5,320',
            '5,011',
            '3,387',
            '4,447',
            '6,678',
            '6,613',
            '4,001',
            '33,666',
            '42,010',
            '168,739',
            '84,021',
            '42,091',
            '76,473'
          ]
        ]);
      });
    });
  });

  describe('limits', function () {
    var grouped;
    beforeEach(function () {
      grouped = _.cloneDeep(require('../fixtures/module-config-grouped-time-series.json'));
    });

    it('will limit the rowns of a table', function () {
      table = new Table(grouped, {rowsLimit: 1});

      table.data.should.eql([
        [ 'Date', 'January 2014' ],
        [ 'Digital and automated phone', 1863942 ],
        [ 'Post Office', 1306292 ],
        [ 'DVLA centre', 13603 ],
        [ 'Totals', 3183837 ]
      ]);
    });
    it('will limit the columns of a table', function () {
      table = new Table(grouped, {colsLimit: 1});

      table.data.should.eql([
        [ 'Date',
          'January 2014',
          'February 2014',
          'March 2014',
          'April 2014',
          'May 2014',
          'June 2014',
          'July 2014',
          'August 2014',
          'September 2014',
          'October 2014',
          'November 2014',
          'December 2014'
        ],
        [ 'Digital and automated phone',
          1863942,
          2514166,
          2167084,
          2376142,
          2115132,
          2032933,
          2207387,
          2189767,
          2855389,
          2646536,
          2157160,
          2629544
        ]
      ]);
    });
    it('will limit both cols and rows', function () {
      table = new Table(grouped, {
        colsLimit: 2,
        rowsLimit: 2
      });

      table.data.should.eql([
        [ 'Date', 'January 2014', 'February 2014' ],
        [ 'Digital and automated phone', 1863942, 2514166 ],
        [ 'Post Office', 1306292, 1637752 ]
      ]);
    });
  });

});
